{"version":3,"file":"modalWindow.js","sources":["../template.js","../modalWindow.ts"],"sourcesContent":["/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getCss(opts = {}) {\n  return `:host{\ndisplay:block;\n}\n.modal {\n  position: fixed;\n  z-index: 10000;\n  left: 0;\n  top: 0;\n  bottom:0;\n  right:0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  opacity: 0;\n  visibility: hidden;\n  transform: scale(1.2);\n  transition: visibility 0s linear 0.25s, opacity 0.25s 0s, transform 0.25s;\n}\n.show-modal {\n  opacity: 1;\n  visibility: visible;\n  transform: scale(1);\n  transition: visibility 0s linear 0s, opacity 0.25s 0s, transform 0.25s;\n}\n.modal-body {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: white;\n  padding: ${opts.padding || \"6em\"} ;\n  width: ${opts.width || \"auto\"};\n  height: ${opts.height || \"auto\"};\n  max-height:100%;\n  max-width:100%;\n  border-radius: 0.5rem;\n  overflow:auto;\n}\n.modal-close {\nposition: absolute;\ntop: 0.3em;\nright: 0.3em;\npadding: 0.3em;\ncursor: pointer;\nfont-size: 2em;\nheight: 0.8em;\nwidth: 0.8em;\ntext-indent: 20em;\noverflow: hidden;\nborder: 0;\nbackground-color:inherit;\n}\n.modal-close::after {\nposition: absolute;\nline-height: 0.5;\ntop: 0.14em;\nleft: 0.12em;\ntext-indent: 0;\ncontent: \"\\\\00D7\";\n}`\n}\n\n/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getHtml(opts = {}) {\n  return `<div class=\"modal\">\n  <div tabindex=\"0\" class=\"modal-body\">\n    <button class=\"modal-close\">close</button>\n    <slot name=\"modal-content\"></slot>\n  </div>\n</div>`\n}\n\n/**\n * @type { {\n * render: (opts?: { padding?:string, width?:string }) => string\n * getHtml: (opts?: { [key: string]: any }) => string\n * getCss: (opts?: { padding?:string, width?:string }) => string\n * } }\n */\nconst Template = {\n  render(opts) {\n    return `<style>${this.getCss(opts)}</style>${this.getHtml(opts)}`\n  },\n  getHtml,\n  getCss,\n};\n\nexport { Template };\n","// @ts-ignore\nimport { Template } from \"./template.js\"\n\nclass ModalWindow extends HTMLElement {\n  root = this.attachShadow({ mode: \"open\" })!\n  dom!: {\n    modal: HTMLDivElement\n    modalClose: HTMLButtonElement\n    slot: HTMLElement\n  }\n  connected = false\n  opts = { showModal: false }\n  constructor() {\n    super()\n  }\n\n  connectedCallback() {\n    this.root.innerHTML = Template.render({ padding: \"2em\" })\n    this.dom = {\n      modal: this.root.querySelector(\".modal\") as HTMLDivElement,\n      modalClose: this.root.querySelector(\".modal-close\") as HTMLButtonElement,\n      slot: this.querySelector('*[slot=\"modal-content\"]') as HTMLElement,\n    }\n    this.connected = true\n    if (this.opts.showModal) this.showModal = true\n  }\n\n  get showModal(): boolean {\n    return this.hasAttribute(\"show-modal\") ? true : false\n  }\n  set showModal(value: boolean) {\n    value === false\n      ? this.dispatchEvent(new CustomEvent(\"modalClose\"))\n      : this.showModalAndWaitForClose()\n  }\n\n  showModalAndWaitForClose() {\n    return new Promise(resolve => {\n      const toggleModal = () => {\n        if (!this.dom.modal.classList.contains(\"show-modal\")) {\n          return this.setAttribute(\"show-modal\", \"\")\n        } else {\n          this.removeAttribute(\"show-modal\")\n          this.dom.modalClose.removeEventListener(\"click\", toggleModal)\n          this.removeEventListener(\"modalClose\", toggleModal)\n          this.dom.modal.removeEventListener(\"click\", handleClickOnModalWindow)\n          resolve()\n        }\n      }\n      const handleClickOnModalWindow = (event: Event) => {\n        if (event.target === this.dom.modal) {\n          toggleModal()\n        }\n      }\n      this.dom.modalClose.addEventListener(\"click\", toggleModal)\n      this.addEventListener(\"modalClose\", toggleModal)\n      this.dom.modal.addEventListener(\"click\", handleClickOnModalWindow)\n      toggleModal()\n    })\n  }\n\n  static get observedAttributes() {\n    return [\"show-modal\"]\n  }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null\n  ) {\n    if (newValue === oldValue) return\n    this.dom.slot=this.querySelector('*[slot=\"modal-content\"]') as HTMLElement\n    switch (name) {\n      case \"show-modal\":\n        if (!this.connected) return (this.opts.showModal = true)\n        if (newValue === null) {\n          this.dom.modal.classList.remove(\"show-modal\")\n          this.dom.slot.style.visibility = \"hidden\"\n          this.dom.slot.style.opacity = \"0\"\n        } else {\n          this.dom.modal.classList.add(\"show-modal\")\n          ;(this.root.querySelector(\".modal-body\")! as HTMLElement).focus()\n          this.dom.slot.style.visibility = \"visible\"\n          this.dom.slot.style.opacity = \"1\"\n        }\n        break\n      default:\n    }\n  }\n\n  static get is() {\n    return \"modal-window\"\n  }\n}\n\ncustomElements.define(ModalWindow.is, ModalWindow)\n\nexport { ModalWindow }\n"],"names":[],"mappings":"AAAA;;;;AAIC,SAAS,MAAM,CAAC,IAAI,GAAG,EAAE;IACxB,OAAO;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;aA8BI,IAAI,CAAC,OAAO,IAAI,KAAK;WACvB,IAAI,CAAC,KAAK,IAAI,MAAM;YACnB,IAAI,CAAC,MAAM,IAAI,MAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;EA2B/B,CAAA;AACF,CAAC;AAED;;;;AAIC,SAAS,OAAO,CAAC,IAAI,GAAG,EAAE;IACzB,OAAO;;;;;OAKF,CAAA;AACP,CAAC;AAED;;;;;;;AAOA,MAAM,QAAQ,GAAG;IACf,MAAM,CAAC,IAAI;QACT,OAAO,UAAU,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAA;KAClE;IACD,OAAO;IACP,MAAM;CACP;;AC7FD;AACA,AAEA,MAAM,WAAY,SAAQ,WAAW;IASnC;QACE,KAAK,EAAE,CAAA;QATT,SAAI,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAE,CAAA;QAM3C,cAAS,GAAG,KAAK,CAAA;QACjB,SAAI,GAAG,EAAE,SAAS,EAAE,KAAK,EAAE,CAAA;KAG1B;IAED,iBAAiB;QACf,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAA;QACzD,IAAI,CAAC,GAAG,GAAG;YACT,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAmB;YAC1D,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,cAAc,CAAsB;YACxE,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,yBAAyB,CAAgB;SACnE,CAAA;QACD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAA;QACrB,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAA;KAC/C;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,GAAG,IAAI,GAAG,KAAK,CAAA;KACtD;IACD,IAAI,SAAS,CAAC,KAAc;QAC1B,KAAK,KAAK,KAAK;cACX,IAAI,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,YAAY,CAAC,CAAC;cACjD,IAAI,CAAC,wBAAwB,EAAE,CAAA;KACpC;IAED,wBAAwB;QACtB,OAAO,IAAI,OAAO,CAAC,OAAO;YACxB,MAAM,WAAW,GAAG;gBAClB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;oBACpD,OAAO,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,EAAE,CAAC,CAAA;iBAC3C;qBAAM;oBACL,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,CAAA;oBAClC,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,mBAAmB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAA;oBAC7D,IAAI,CAAC,mBAAmB,CAAC,YAAY,EAAE,WAAW,CAAC,CAAA;oBACnD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,mBAAmB,CAAC,OAAO,EAAE,wBAAwB,CAAC,CAAA;oBACrE,OAAO,EAAE,CAAA;iBACV;aACF,CAAA;YACD,MAAM,wBAAwB,GAAG,CAAC,KAAY;gBAC5C,IAAI,KAAK,CAAC,MAAM,KAAK,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE;oBACnC,WAAW,EAAE,CAAA;iBACd;aACF,CAAA;YACD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,gBAAgB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAA;YAC1D,IAAI,CAAC,gBAAgB,CAAC,YAAY,EAAE,WAAW,CAAC,CAAA;YAChD,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,gBAAgB,CAAC,OAAO,EAAE,wBAAwB,CAAC,CAAA;YAClE,WAAW,EAAE,CAAA;SACd,CAAC,CAAA;KACH;IAED,WAAW,kBAAkB;QAC3B,OAAO,CAAC,YAAY,CAAC,CAAA;KACtB;IAED,wBAAwB,CACtB,IAAY,EACZ,QAAuB,EACvB,QAAuB;QAEvB,IAAI,QAAQ,KAAK,QAAQ;YAAE,OAAM;QACjC,IAAI,CAAC,GAAG,CAAC,IAAI,GAAC,IAAI,CAAC,aAAa,CAAC,yBAAyB,CAAgB,CAAA;QAC1E,QAAQ,IAAI;YACV,KAAK,YAAY;gBACf,IAAI,CAAC,IAAI,CAAC,SAAS;oBAAE,QAAQ,IAAI,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,EAAC;gBACxD,IAAI,QAAQ,KAAK,IAAI,EAAE;oBACrB,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,CAAC,CAAA;oBAC7C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAA;oBACzC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAA;iBAClC;qBAAM;oBACL,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CACzC;oBAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,aAAa,CAAkB,CAAC,KAAK,EAAE,CAAA;oBACjE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,SAAS,CAAA;oBAC1C,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAA;iBAClC;gBACD,MAAK;SAER;KACF;IAED,WAAW,EAAE;QACX,OAAO,cAAc,CAAA;KACtB;CACF;AAED,cAAc,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,EAAE,WAAW,CAAC,CAAA;;;;"}