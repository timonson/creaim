{"version":3,"file":"dragAndDrop.js","sources":["../template.js","../dragAndDrop.ts"],"sourcesContent":["/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getCss(opts = {}) {\n  return `:host {\n  position: absolute;\n  z-index: 1000;\n  outline: none;\n  border-radius: 45px;\n  border: 0.5px solid dimgrey;\n  cursor: auto;\n  /* max-width: 12em; */\n  /* overflow-x: auto; */\n  /* height: auto; */\n  /* font-family: Arial; */\n  /* font-size: 1.1rem; */\n  /* font-weight: bold; */\n  /* text-transform: uppercase; */\n  /* border: solid darkgrey 1px; */\n  /* border-radius: 20px; */\n}\n:host(:hover) {\n  border: solid dimgrey 1.5px;\n  transform: scale(1.1);\n}\n:host(:focus-within) {\n  border: solid dimgrey 1.5px;\n  /* transform: scale(1.1); */\n}\n:host(.activated) {\n  /* border: solid darkslategrey 2.5px !important; */\n  border: solid darkslategrey 2.5px !important;\n}\n::slotted(*) {\n  border-radius: 45px;\n  border: none;\n  /* padding: 0.5em 0.6em 0.5em 1.1em; */\n  /* margin: auto; */\n  /* width: 100%; */\n  /* height: 100%; */\n  /* position: relative; */\n  /* border-radius: inherit; */\n  /* border: inherit; */\n  /* background-color: inherit; */\n  /* font: inherit; */\n  /* text-transform: inherit; */\n  /* border: none; */\n  /* border-radius: inherit; */\n}`\n}\n\n/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getHtml(opts = {}) {\n  return `<slot spellcheck=\"false\" name=\"embedded\"></slot>`\n}\n\n/**\n * @type { {\n * render: (opts?: { [key: string]: any }) => string\n * getHtml: (opts?: { [key: string]: any }) => string\n * getCss: (opts?: { [key: string]: any }) => string\n * } }\n */\nconst Template = {\n  render(opts) {\n    return `<style>${this.getCss(opts)}</style>${this.getHtml(opts)}`\n  },\n  getHtml,\n  getCss,\n};\n\nexport { Template };\n","import { Template } from \"./template.js\"\n\nclass DragAndDrop extends HTMLElement {\n  private root = this.attachShadow({ mode: \"open\" })!\n  private dom!: {\n    slotElement: HTMLElement\n  }\n  private connected = false\n  boundary!: { left: number; top: number }\n  constructor() {\n    super()\n    this.addEventListener(\"mousedown\", this.dragAndDropCurrentTarget)\n  }\n\n  get activated(): string | null {\n    return this.getAttribute(\"activated\")\n  }\n  set activated(value: string | null) {\n    value == null\n      ? this.removeAttribute(\"activated\")\n      : this.setAttribute(\"activated\", \"\")\n  }\n  // https://javascript.info/mouse-drag-and-drop\n  private dragAndDropCurrentTarget(event: MouseEvent) {\n    if (event.button !== 0) return\n    const targetElement = event.currentTarget as DragAndDrop\n    const draggingStartEvent = new CustomEvent(\"draggingStart\", {\n      bubbles: true,\n      composed: true,\n      detail: targetElement,\n    })\n    const draggingEndEvent = new CustomEvent(\"draggingEnd\", {\n      bubbles: true,\n      composed: true,\n      detail: targetElement,\n    })\n    function surroundMouseWithElement(\n      pageX: number,\n      pageY: number,\n      element: HTMLElement\n    ) {\n      return [\n        pageX -\n          (pageXOffset + element.offsetParent!.getBoundingClientRect().left) -\n          element.offsetWidth / 2,\n        pageY -\n          (pageYOffset + element.offsetParent!.getBoundingClientRect().top) -\n          element.offsetHeight / 2,\n      ]\n    }\n    function checkBoundaries(value: number, boundary: number) {\n      return value <= 0 ? 0 : Math.min(boundary, value)\n    }\n    function moveAt(event: MouseEvent) {\n      const [calculatedLeft, calculatedTop] = surroundMouseWithElement(\n        event.pageX,\n        event.pageY,\n        targetElement\n      )\n      targetElement.style.left =\n        checkBoundaries(\n          calculatedLeft,\n          targetElement.boundary.left - targetElement.offsetWidth\n        ) + \"px\"\n      targetElement.style.top =\n        checkBoundaries(\n          calculatedTop,\n          targetElement.boundary.top - targetElement.offsetHeight\n        ) + \"px\"\n    }\n    targetElement.dispatchEvent(draggingStartEvent)\n    //  move the ball on mousemove\n    document.addEventListener(\"mousemove\", moveAt)\n    const cancelId = setTimeout(() => {\n      targetElement.style.cursor = \"grab\"\n    }, 100)\n    // drop the ball, remove unneeded handlers\n    document.addEventListener(\n      \"mouseup\",\n      event => {\n        targetElement.dispatchEvent(draggingEndEvent)\n        clearTimeout(cancelId)\n        targetElement.style.cursor = \"auto\"\n        document.removeEventListener(\"mousemove\", moveAt)\n      },\n      { once: true }\n    )\n    // the browser has its own Drag’n’Drop for images and some other elements\n    // that runs automatically and conflicts with ours\n    targetElement.ondragstart = () => false\n  }\n  connectedCallback() {\n    this.root.innerHTML = Template.render()\n    this.dom = {\n      slotElement: this.querySelector(\"*[slot='embedded']\") as HTMLElement,\n    }\n    this.boundary = {\n      left: (this.offsetParent as HTMLElement).offsetWidth,\n      top: (this.offsetParent as HTMLElement).offsetHeight,\n    }\n    this.connected = true\n  }\n  static get observedAttributes() {\n    return [, \"activated\"]\n  }\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null\n  ) {\n    switch (name) {\n      case \"activated\":\n        newValue !== null\n          ? this.classList.add(\"activated\")\n          : this.classList.remove(\"activated\")\n        break\n      default:\n    }\n  }\n  static get is() {\n    return \"drag-and-drop\"\n  }\n}\n\ncustomElements.define(DragAndDrop.is, DragAndDrop)\n\nexport { DragAndDrop }\n"],"names":[],"mappings":"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"}