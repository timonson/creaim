{"version":3,"file":"anyFileDownloader.js","sources":["../template.js","../anyFileDownloader.ts"],"sourcesContent":["/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getCss(opts = {}) {\n  return `:host {\n  display: inline-block;\n  font-family: \"Arial\";\n  cursor:pointer;\n}\na {\n  padding: 0.3em;\n  border: 1px solid darkgrey;\n  border-radius: 5px;\n  color:inherit;\n     text-decoration:none; \n}\n\na:hover {\n  background-color: lightgrey;\n}`\n}\n\n/**\n * @param {{ [key: string]: any }} opts\n * @returns {string}\n */\n function getHtml(opts = {}) {\n  return `<a id=\"download-anchor\" download=\"${opts.filename}\">${opts.content}</a>`\n}\n\n/**\n * @type { {\n * render: (opts?: { filename?: string, fileType?:string, content?:string  }) => string\n * getHtml: (opts?: { [key: string]: any }) => string\n * getCss: (opts?: { [key: string]: any   }) => string\n * } }\n */\nconst Template = {\n  render(opts) {\n    return `<style>${this.getCss(opts)}</style>${this.getHtml(opts)}`\n  },\n  getHtml,\n  getCss,\n};\n\nexport { Template };\n","import { Template } from \"./template.js\"\n\nfunction waitForEvent(\n  eventTarget: EventTarget,\n  eventName: string\n): Promise<Event> {\n  return new Promise(resolve => {\n    function listener(event: Event) {\n      resolve(event)\n      eventTarget.removeEventListener(eventName, listener)\n    }\n    eventTarget.addEventListener(eventName, listener)\n  })\n}\n\nclass AnyFileDownloader extends HTMLElement {\n  private root = this.attachShadow({ mode: \"open\" })!\n  private dom!: { anchor: HTMLElement }\n  opts = { fileType: \"\", filename: \"\", content: \"\" }\n  makeDownload!: (\n    str: string | (() => string),\n    fileType?: string\n  ) => Promise<string>\n  constructor() {\n    super()\n    this.makeDownload = this._makeDownload.bind(this)\n  }\n  connectedCallback() {\n    this.opts.content = this.textContent || \"\"\n    this.root.innerHTML = Template.render(this.opts)\n    this.dom = {\n      anchor: this.root.querySelector(\"#download-anchor\") as HTMLElement,\n    }\n  }\n\n  private async _makeDownload(\n    str: string | (() => string),\n    fileType: string = this.getAttribute(\"file-type\") || \"\"\n  ) {\n    function setBlob(anchor: HTMLElement, str: string, fileType: string) {\n      const blob = new Blob([str], { type: fileType })\n      const url = URL.createObjectURL(blob)\n      anchor.setAttribute(\"href\", url)\n      return blob\n    }\n    let realString = \"\"\n    if (typeof str === \"string\") {\n      realString = str\n      setBlob(this.dom.anchor, str, fileType)\n    } else {\n      const event = await waitForEvent(this.dom.anchor, \"click\")\n      realString = str()\n      setBlob(this.dom.anchor, realString, fileType)\n    }\n    return realString\n  }\n\n  static get observedAttributes() {\n    return [\"fileType\", \"filename\"]\n  }\n\n  attributeChangedCallback(\n    name: string,\n    oldValue: string | null,\n    newValue: string | null\n  ) {\n    if (newValue === oldValue) return\n    this.opts = { ...this.opts, [name]: newValue }\n  }\n\n  get fileType(): string | null {\n    return this.getAttribute(\"file-type\")\n  }\n  set fileType(value: string | null) {\n    if (value === null) this.removeAttribute(\"file-type\")\n    else this.setAttribute(\"file-type\", value)\n  }\n  get filename(): string | null {\n    return this.getAttribute(\"filename\")\n  }\n  set filename(value: string | null) {\n    if (value === null) this.removeAttribute(\"filename\")\n    else this.setAttribute(\"filename\", value)\n  }\n\n  static get is() {\n    return \"any-file-downloader\"\n  }\n}\n\ncustomElements.define(AnyFileDownloader.is, AnyFileDownloader)\n\nexport { AnyFileDownloader }\n"],"names":[],"mappings":"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"}